% Structure data and save in a format that can be loaded in python (just for grid cells)
% Based on https://github.com/johnson-ying/Code-for-Ying-et-al.-2023/blob/main/Figure_2/Grid%20component%20extraction.m
% Clone CMBHOME (https://github.com/hasselmonians/CMBHOME) directly under the main directory
% Place this code inside Code-for-Ying-et-al.-2023/Figure_2/
% Run the following commands from inside Figure_2 to generate data
% addpath ../session_data
% addpath ../session_data2
% addpath ../CMBHOME
% import CMBHOME.*
% data_converter

clear

%load grid cell directories
%name, age, file name, cel 
wty_dir = {
'12375',111,'2016-10-31_11-37-34', [2,1]
'3630',111,'2017-10-14_18-11-29', [2,1]
'3630',111,'2017-10-14_18-11-29', [2,2]
'3630',111,'2017-10-14_18-11-29', [2,3]
'3630',112,'2017-10-15_14-39-43', [2,3]
'3630',113,'2017-10-16_13-44-27', [2,2]
'3630',113,'2017-10-16_13-44-27', [2,4]
'3630',114,'2017-10-17_10-56-56', [2,2]
'3630',115,'2017-10-18_11-58-36', [2,1]
'3630',115,'2017-10-18_11-58-36', [2,2]
'3630',115,'2017-10-18_11-58-36', [2,5]
'3630',117,'2017-10-20_10-27-02', [2,6]
'3630',117,'2017-10-20_10-27-02', [2,10]
'3630',118,'2017-10-21_12-59-45', [2,2]
'3630',118,'2017-10-21_12-59-45', [2,5]
'3630',123,'2017-10-26_10-48-46', [4,1]
'3630',129,'2017-11-01_14-53-49', [2,5] %%
'3630',129,'2017-11-01_15-23-22', [2,1]
'3630',130,'2017-11-02_13-15-31', [2,1]
'3630',130,'2017-11-02_13-15-31', [2,3]
'3630',130,'2017-11-02_13-15-31', [2,4]
'3630',130,'2017-11-02_13-15-31', [2,9]
'3630',131,'2017-11-03_11-58-06', [2,4]
'3798',81,'2017-10-20_12-15-03', [3,1] %
'3798',92,'2017-10-31_17-34-14', [3,3]
'3798',95,'2017-11-03_13-58-52', [2,1]
'3798',112,'2017-11-21_16-00-47', [3,1]
'3798',113,'2017-11-22_15-30-45', [3,1]
'3884',94,'2017-11-27_12-43-08', [2,1]
'3885',85,'2017-11-18_14-00-00', [4,1]
'3885',87,'2017-11-20_13-38-57', [4,4] %
'3885',89,'2017-11-22_16-29-17', [4,1]
'3885',111,'2017-12-14_11-09-18', [2,1]
'3885',116,'2017-12-19_08-04-59', [2,1]
'3895',97,'2017-12-04_14-53-21', [2,1] %
'4849',100,'2018-05-20_10-21-00', [1,1] %
};

%name, age, file name, cel 
wta_dir = {
'12746',160,'2017-06-20_11-37-17', [2,2] %
'12746',161,'2017-06-21_09-00-24', [2,1] %
'12748',163,'2017-06-23_08-54-07', [2,1]
'12748',164,'2017-06-24_20-19-29', [1,3]
'12748',164,'2017-06-24_20-19-29', [1,4]
'12748',166,'2017-06-26_15-26-01', [2,1]
'12748',177,'2017-07-07_08-12-32', [2,1]
'12748',180,'2017-07-10_17-59-49', [2,1]
'12748',183,'2017-07-13_14-07-08', [1,1]
'12748',183,'2017-07-13_14-07-08', [2,4]
'12748',187,'2017-07-17_11-30-14', [2,1]
'12748',188,'2017-07-18_16-25-51', [1,1]
'12748',188,'2017-07-18_16-25-51', [2,1]
% '12786',193,'2017-07-25_18-39-46', [3,1] %room 3
% '12787',204,'2017-08-05_17-54-54', [4,4] % room 3
% '12791',206,'2017-08-08_16-48-04', [3,3]   %room 3
'3630',157,'2017-11-29_14-27-14', [2,1]
'3630',157,'2017-11-29_14-27-14', [2,9]
'3630',159,'2017-12-01_10-06-36', [2,1]
'3630',159,'2017-12-01_10-06-36', [2,3]
'3630',159,'2017-12-01_10-06-36', [2,5]
'3630',159,'2017-12-01_10-06-36', [2,6]
'3630',160,'2017-12-02_16-07-12', [2,2]
'3630',160,'2017-12-02_16-07-12', [2,6]
'3630',160,'2017-12-02_16-07-12', [2,10]
'3630',162,'2017-12-04_11-37-16', [2,2]
'3630',162,'2017-12-04_11-37-16', [2,3]
'3630',162,'2017-12-04_11-37-16', [2,4]
'3630',162,'2017-12-04_11-37-16', [2,7]
'3630',164,'2017-12-06_12-43-31', [2,2]
'3630',164,'2017-12-06_12-43-31', [2,5]
'3630',164,'2017-12-06_12-43-31', [2,6]
'3630',164,'2017-12-06_12-43-31', [2,7]
'3630',164,'2017-12-06_12-43-31', [2,8]
'3630',166,'2017-12-08_10-04-20', [2,1]
'3630',166,'2017-12-08_10-04-20', [2,2]
'3630',167,'2017-12-09_09-56-49', [2,1]
'3630',169,'2017-12-11_11-17-41', [2,2]
'3630',169,'2017-12-11_11-17-41', [2,3]
'3630',171,'2017-12-13_08-51-13', [2,1]
'3630',171,'2017-12-13_08-51-13', [2,2]
'3781',175,'2018-01-20_09-46-11', [3,1]
'3781',175,'2018-01-20_09-46-11', [3,2]
'3781',177,'2018-01-22_09-19-56', [3,2]
'3781',178,'2018-01-23_11-14-06', [3,1]
'3782',166,'2018-01-11_09-30-56', [3,1]
'3782',167,'2018-01-12_09-36-37', [3,2]
'3782',167,'2018-01-12_09-36-37', [3,3]
'3782',170,'2018-01-15_10-13-43', [3,4]
'3782',171,'2018-01-16_09-00-39', [3,1]
'3782',171,'2018-01-16_09-00-39', [3,2]
'3782',171,'2018-01-16_09-00-39', [3,3]
'3782',171,'2018-01-16_09-00-39', [3,5]
'3782',172,'2018-01-17_07-35-10', [3,3]
'3782',173,'2018-01-18_06-58-36', [3,2]
'3782',180,'2018-01-25_10-07-42', [3,1]
'3782',184,'2018-01-29_09-44-17', [3,3]
'3782',192,'2018-02-06_10-16-21', [3,1] %%
'3782',193,'2018-02-07_12-06-08', [3,1]
'3783',164,'2018-01-09_06-47-40', [3,1]
'3783',164,'2018-01-09_06-47-40', [3,2]
'3783',164,'2018-01-09_06-47-40', [3,3]
'3783',173,'2018-01-18_08-03-14', [2,1]
'3783',187,'2018-02-01_12-44-37', [4,1]
'3783',187,'2018-02-01_12-44-37', [4,2]
'3784',164,'2018-01-09_08-45-43', [2,2]
'5036',147,'2018-08-01_11-40-28', [2,3]
};

%name, age, file name, cel 
j20y_dir = {
'3532',73,'2017-08-28_17-40-14', [3,1]
'3532',87,'2017-09-11_17-46-00', [3,1]
'3532',89,'2017-09-13_14-20-38', [3,1]
'3532',108,'2017-10-07_19-27-44', [2,1]
'3534',90,'2017-09-14_17-48-46', [2,1] %
'3534',94,'2017-09-18_16-24-43', [2,2]
'3534',96,'2017-09-20_13-14-34', [2,1]
'3534',98,'2017-09-22_08-21-53', [2,2]
'3534',99,'2017-09-23_15-41-23', [2,1]
'3534',101,'2017-09-25_16-05-39', [2,1]
'3534',106,'2017-09-30_09-57-33', [2,2]
'3534',113,'2017-10-07_17-39-21', [2,2]
'3534',123,'2017-10-17_14-13-47', [2,2]
'3534',123,'2017-10-17_14-13-47', [2,3]
'3799',92,'2017-10-31_18-19-37', [2,1]
'3799',94,'2017-11-02_12-13-30', [2,1]
'3799',95,'2017-11-03_12-58-39', [2,1]
'3799',95,'2017-11-03_12-58-39', [2,2]
'3799',95,'2017-11-03_12-58-39', [2,3]
'3799',98,'2017-11-06_15-18-39', [2,2]
'3799',101,'2017-11-09_12-45-59', [2,2]
'3799',105,'2017-11-13_13-21-26', [2,1]
'3799',106,'2017-11-14_12-40-24', [2,1]
'3799',107,'2017-11-15_13-15-46', [2,2]
'4756',105,'2018-05-13_11-08-01', [4,1] %
'4756',109,'2018-05-17_11-39-53', [3,4]
'4756',116,'2018-05-24_11-16-47', [1,2] %
'4757',101,'2018-05-09_14-55-27', [2,2]
'4757',105,'2018-05-13_09-31-04', [2,1]
'4757',116,'2018-05-24_12-07-19', [2,1]
'5035',109,'2018-06-24_10-03-42', [2,1]
'5035',109,'2018-06-24_10-03-42', [2,3]
};

%name, age, file name, cel 
j20a_dir = {
'12040',189,'2016-06-23_09-46-05', [1,3]
'12758',197,'2017-07-28_10-58-12', [1,1] % 
% '12784',189,'2017-07-21_09-48-54', [1,4] %
'12785',199,'2017-07-31_13-46-28', [4,1] %%
'12790',202,'2017-08-02_14-00-01', [1,1]
'12790',223,'2017-08-23_15-59-11', [2,3]
'12792',222,'2017-08-22_09-28-08', [2,1]
'3683',167,'2017-12-22_10-09-34', [2,1]
'3828',183,'2018-02-07_10-32-05', [2,3] %
'3828',191,'2018-02-15_10-38-44', [4,2]
'3828',193,'2018-02-17_11-31-56', [4,1]
'3828',193,'2018-02-17_11-31-56', [4,2]
'3828',193,'2018-02-17_11-31-56', [4,3]
'3828',195,'2018-02-19_07-09-35', [4,1]
'3828',195,'2018-02-19_07-09-35', [4,2]
'3894',207,'2018-03-24_13-57-16', [3,2]
'3894',208,'2018-03-25_11-59-44', [3,3]
'3931',188,'2018-03-07_15-31-00', [2,1]
'4014',182,'2018-03-22_09-53-04', [1,2]
'4118',170,'2018-04-12_08-58-34', [2,1]
'4118',175,'2018-04-17_11-13-55', [2,1]
'4118',175,'2018-04-17_11-13-55', [2,2]
'4118',179,'2018-04-21_14-28-21', [2,1]
'4118',179,'2018-04-21_14-28-21', [2,2]
'4118',180,'2018-04-22_10-38-42', [2,2]
'4125',167,'2018-04-09_07-50-41', [2,3]
'4125',168,'2018-04-10_09-55-44', [2,1]
'4125',168,'2018-04-10_09-55-44', [2,3]
'4125',171,'2018-04-13_07-56-17', [2,1]
'4125',171,'2018-04-13_07-56-17', [2,3]
'4125',175,'2018-04-17_10-14-48', [2,1]
'4125',178,'2018-04-20_12-41-05', [2,2]
'4125',178,'2018-04-20_12-41-05', [2,3]
'4593',203,'2018-07-25_11-14-43', [1,2]
'4593',206,'2018-07-28_08-02-42', [1,1]
'4593',211,'2018-08-02_07-57-28', [1,4]
'4599',207,'2018-07-29_08-45-08', [2,4]
'4623',208,'2018-08-02_08-38-32', [1,2]
'4754',157,'2018-07-04_11-04-48', [3,3] %
'4757',182,'2018-07-29_10-34-37', [2,4]
};

dir_lists = {wty_dir,wta_dir,j20y_dir,j20a_dir};
dir_names = ["wty", "wta", "j20y", "j20a"];

mkdir("../extracted")
for cat_id = 1:4
dir_list = dir_lists{cat_id};
dir_name = dir_names(cat_id);
mkdir("../extracted", dir_name)
for celliter = 1:size(dir_list,1)
    disp(celliter)
    
    clear root
    %load cell
    load(dir_list{celliter,3});
    cel = dir_list{celliter,4};
    spikes = root.spike(cel(1),cel(2));
    
    clear new_data
    new_data = struct();
    new_data.x = root.x;
    new_data.y = root.y;
    new_data.t = root.ts;
    new_data.spki = spikes.i;
    new_data.spkt = spikes.ts;

    save(strcat("../extracted/",dir_name,"/",dir_list{celliter,3},"-",int2str(cel(1)),"-",int2str(cel(2))),"-struct","new_data")
end
end

